<template>
  <div>
    <div class="popup_form hide" id="form-container">
      <div class="form_body" style="padding-top:25px">
        <p
          @click="close_popup"
          style="position:absolute;right:10px;top:0;font-size:25px;cursor:pointer"
        >x</p>
        <div class="row">
          <div class="col s24">
            <h4>Fill up this form for the best offers</h4>
          </div>
          <div class="col s24">
            <div class="form">
              <label>Full Name</label>
              <input id="full_name" type="text" placeholder="Full Name" autocomplete="off" />
            </div>
          </div>
          <div class="col s24">
            <div class="form">
              <label>Email</label>
              <input id="email" type="email" autocomplete="off" placeholder="Email Address" />
            </div>
          </div>
          <div class="col s24">
            <div style="display: flex; justify-content: flex-end;margin-top:25px">
              <button class="btn" type="submit" @click="submitForm">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="popup_form hide" id="after-form">
      <div class="form_body" style="padding-top:25px">
        <p
          @click="close_popup_after"
          style="position:absolute;right:10px;top:0;font-size:25px;cursor:pointer"
        >x</p>
        <div class="row">
          <div class="col s24">
            <h4>Please save the transaction ID for future reference</h4>
            <p>Transaction ID: {{transaction_id}}</p>
            <p>Call the below number to confirm your booking at the lowest fare</p>
            <p>+91 700505019198</p>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-image">
      <div class="container section">
        <!-- <h1 style="color:white; text-align:center;font-size: 25px;margin: 25px 0;">Search Flight</h1> -->

        <div class="card main_section">
          <div style="display: flex;align-items: center;">
            <p>
              <input
                type="radio"
                id="test1"
                name="radio-group"
                value="oneway"
                checked
                v-model="picked"
              />
              <label for="test1">ONEWAY</label>
            </p>
            <p>
              <input type="radio" id="test2" name="radio-group" value="roundtrip" v-model="picked" />
              <label for="test2">ROUND TRIP</label>
            </p>
          </div>

          <div class="row">
            <div class="col s12 m6 l4">
              <div class="form">
                <label>From</label>
                <input
                  id="from_des"
                  @keydown="clearCountdown"
                  @keyup="startCountdown"
                  type="text"
                  autocomplete="off"
                  placeholder="From"
                />
                <input type="hidden" id="from_iata" value="GAU" />
                <div class="dropdown des hide">
                  <ul>
                    <li
                      v-for="p in airportList"
                      :key="p.id"
                      class="airport_select"
                      :id="'airport_dep-'+p.id"
                      @click="selectDep(p.id)"
                    >
                      <div style="display:flex;flex-direction:column;margin-bottom: 10px">
                        <div>{{p.municipality}},{{p.iso_country}}</div>
                        <div style="font-size:12px;line-height:12px;color:#666">{{p.name}}</div>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="col s12 m6 l4">
              <div class="form">
                <label>To</label>
                <input
                  id="to_arr"
                  @keydown="clearCountdown"
                  @keyup="startCountdownArr"
                  type="text"
                  autocomplete="off"
                  placeholder="Destination"
                />
                <input type="hidden" id="to_iata" value="DEL" />
                <div class="dropdown arr hide">
                  <ul>
                    <li
                      v-for="p in airportListArr"
                      :key="p.id"
                      class="airport_select"
                      :id="'airport_dep-'+p.id"
                      @click="selectArr(p.id)"
                    >
                      <div style="display:flex;flex-direction:column;margin-bottom: 10px">
                        <div>{{p.municipality}},{{p.iso_country}}</div>
                        <div style="font-size:12px;line-height:12px;color:#666">{{p.name}}</div>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="col s12 m6 l3">
              <div class="form">
                <label>Departure</label>
                <input
                  type="text"
                  class="datepicker-here"
                  data-position="bottom left"
                  data-language="en"
                  data-date-format="yyyy-mm-dd"
                  placeholder="Departure"
                  readonly="readonly"
                  id="dep_date"
                />
              </div>
            </div>
            <div class="col s12 m6 l3">
              <div class="form">
                <label>Return</label>
                <input
                  :disabled="picked != 'roundtrip'"
                  type="text"
                  class="datepicker-here"
                  data-position="bottom left"
                  data-language="en"
                  data-date-format="yyyy-mm-dd"
                  placeholder="Return"
                  readonly="readonly"
                  id="ret_date"
                />
              </div>
            </div>
            <div class="col s24 m6 l3">
              <div class="form">
                <label>Travel Class</label>
                <!-- <select id="travel-class">
                <option>ECONOMY</option>
                <option>BUSINESS</option>
                </select>-->
                <div class="drop-down drop-down_ui">
                  <div class="selected">
                    <a href="#">
                      <span>Economy</span>
                      <span class="value">ECONOMY</span>
                    </a>
                  </div>
                  <div class="options">
                    <ul>
                      <li>
                        <a href="#">
                          Economy
                          <span class="value">ECONOMY</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          Business
                          <span class="value">BUSINESS</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          First
                          <span class="value">FIRST</span>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s8 m6 l2">
              <div class="form">
                <label>Adult</label>
                <!-- <select id="travel-class">
                <option>ECONOMY</option>
                <option>BUSINESS</option>
                </select>-->
                <div class="drop-down1 drop-down_ui">
                  <div class="selected">
                    <a href="#">
                      <span>1</span>
                      <span class="value">1</span>
                    </a>
                  </div>
                  <div class="options">
                    <ul>
                      <li>
                        <a href="#">
                          1
                          <span class="value">1</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          2
                          <span class="value">2</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          3
                          <span class="value">3</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          4
                          <span class="value">4</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          5
                          <span class="value">5</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          6
                          <span class="value">5</span>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s8 m6 l2">
              <div class="form">
                <label>Children</label>
                <!-- <select id="travel-class">
                <option>ECONOMY</option>
                <option>BUSINESS</option>
                </select>-->
                <div class="drop-down2 drop-down_ui">
                  <div class="selected">
                    <a href="#">
                      <span>0</span>
                      <span class="value">0</span>
                    </a>
                  </div>
                  <div class="options">
                    <ul>
                      <li>
                        <a href="#">
                          0
                          <span class="value">0</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          1
                          <span class="value">1</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          2
                          <span class="value">2</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          3
                          <span class="value">3</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          4
                          <span class="value">4</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          5
                          <span class="value">5</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          6
                          <span class="value">5</span>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s8 m6 l2">
              <div class="form">
                <label>Infants</label>
                <!-- <select id="travel-class">
                <option>ECONOMY</option>
                <option>BUSINESS</option>
                </select>-->
                <div class="drop-down3 drop-down_ui">
                  <div class="selected">
                    <a href="#">
                      <span>0</span>
                      <span class="value">0</span>
                    </a>
                  </div>
                  <div class="options">
                    <ul>
                      <li>
                        <a href="#">
                          0
                          <span class="value">0</span>
                        </a>
                      </li>
                      <li>
                        <a href="#">
                          1
                          <span class="value">1</span>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <!-- 
          <div class="col l6">
            <button type="button" @click="submit" class="btn bold">Search</button>
            </div>-->

            <div class="col s24 l24" style="padding-top: 10px">
              <button type="button" @click="submit" class="btn bold">Search</button>
            </div>

            <!-- <div class="col s24 l24">
            <p>These are for testing purpose only</p>
          </div>
          <div class="col s24 l24">
            <div style="display: flex;align-items: center;">
              <p>
                <input
                  type="radio"
                  id="source"
                  name="radio-group1"
                  value="amadeus"
                  checked
                  v-model="source"
                />
                <label for="source">Amadeus</label>
              </p>
              <p>
                <input
                  type="radio"
                  id="source1"
                  name="radio-group1"
                  value="goibibo"
                  v-model="source"
                />
                <label for="source1">GoIbibo</label>
              </p>
            </div>
            </div>-->
          </div>

          <!-- <div style="border:1px solid #e8e8e8; border-radius: 5px; margin: 10px 0; padding: 10px 0">
				<input type="text">
			</div>
          -->
        </div>
      </div>
    </div>

    <div class="hide" style="background-color:#f5f5f5" id="result_section">
      <div class="container section">
        <h3>Search Results</h3>

        <div class="loader hide" style="text-align:center">
          <svg
            class="spinner"
            width="35px"
            height="35px"
            viewBox="0 0 66 66"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle
              class="path"
              fill="none"
              stroke-width="6"
              stroke-linecap="round"
              cx="33"
              cy="33"
              r="30"
            />
          </svg>
        </div>

        <div class="row">
          <div class="col s24">
            <div id="amadeus">
              <div class="card oneseg" v-for="(p, index) in amadeus" :key="p.id">
                <div class="oneway">
                  <div class="flight_name">
                    <img
                      class="carrier_icon"
                      :src="'https://c.fareportal.com/n/common/air/3x/' + p.carrier_icon + '.png'"
                    />
                    <p>{{ p.carrier_name }}</p>
                  </div>
                  <div class="flight_data flex-between">
                    <div class="flight_departure_time">
                      <div class="flex-center flight_origin">
                        <h5>{{ p.origin }}</h5>
                        <p class="pl-5 clamp1" style="width: 130px;">{{ p.origin_fullname }}</p>
                      </div>
                      <p class="flight_departure">{{ p.dep_time }}</p>
                    </div>
                    <div class="extra_duration extar_flight_origin center">
                      <p style="font-size:11px;color:#b5b5b5">Flight Duration</p>
                      <h5>{{p.duration}}</h5>
                    </div>
                    <div class="flight_arrival_time">
                      <div class="flex-center flight_origin">
                        <h5>{{ p.destination }}</h5>
                        <p class="pl-5 clamp1" style="width: 130px;">{{ p.destination_fullname }}</p>
                      </div>
                      <p class="flight_arrival">{{ p.arr_time }}</p>
                    </div>
                    <div class="flight_price">
                      <h3>$ {{ p.price }}</h3>
                    </div>
                    <div class="flight_book">
                      <button type="button" @click="open_form(p)" class="btn">Book Now</button>
                    </div>
                  </div>
                </div>

                <hr v-if="p.isRound == 1" class="dashed-line" />

                <div class="return" v-if="p.isRound == 1">
                  <div class="flight_name">
                    <img
                      class="carrier_icon"
                      :src="'https://c.fareportal.com/n/common/air/3x/' + p.round_carrier_icon + '.png'"
                    />
                    <p>{{ p.round_carrier_name }}</p>
                  </div>
                  <div class="flight_data flex-between row">
                    <div class="flight_departure_time col s12">
                      <div class="flex-center flight_origin">
                        <h5>{{ p.round_origin }}</h5>
                        <p class="pl-5 clamp1" style="width: 130px;">{{ p.round_origin_fullname }}</p>
                      </div>
                      <p class="flight_departure">{{ p.round_dep_time }}</p>
                    </div>
                    <div class="extra_duration extar_flight_origin center">
                      <p style="font-size:11px;color:#b5b5b5">Flight Duration</p>
                      <h5>{{p.round_duration}}</h5>
                    </div>
                    <div class="flight_arrival_time">
                      <div class="flex-center flight_origin">
                        <h5>{{ p.round_destination }}</h5>
                        <p
                          class="pl-5 clamp1"
                          style="width: 130px;"
                        >{{ p.round_destination_fullname }}</p>
                      </div>
                      <p class="flight_arrival">{{ p.round_arr_time }}</p>
                    </div>
                    <div class="flight_price">
                      <h3>$ {{ p.round_price }}</h3>
                    </div>
                    <div class="flight_book">
                      <button type="button" style="opacity:0" class="btn">Book Now</button>
                    </div>
                  </div>
                </div>

                <div style="display:flex;justify-content: space-between">
                  <p
                    style="font-size:12px;font-style:italic;color:#949494;font-family:'Manjari'"
                  >No Baggage info available</p>
                  <p class="show_flight" @click="showDetail(index)">Flight Details</p>
                </div>

                <div class="flight_details hide" :id="'fd-' + index">
                  <div class="flight_details_border">
                    <div v-for="(q , qIndex) in amadeus[index].seg" :key="q.id">
                      <hr v-if="qIndex != 0" class="dashed-line" />
                      <div class="extra_flight_data flex-between">
                        <div class="extra_flight_name">
                          <img
                            class="extra_carrier_icon"
                            :src="'https://c.fareportal.com/n/common/air/3x/' + q.carrier_icon + '.png'"
                          />
                          <p>{{ q.carrier_name }}</p>
                          <p>{{ q.carrier_icon }} - {{ q.flight_number }}</p>
                        </div>
                        <div class="flight_departure_time">
                          <div class="flex-center extar_flight_origin">
                            <h5>{{ q.origin }}</h5>
                            <p
                              class="extra_flight_departure"
                              style="padding-left:10px"
                            >{{ q.dep_time }}</p>
                          </div>
                          <p class="pl-5 extra_destination">{{ q.origin_fullname }}</p>
                        </div>
                        <div class="extra_duration extar_flight_origin center">
                          <p style="font-size:11px;color:#b5b5b5">Flight Duration</p>
                          <h5>{{q.duration}}</h5>
                        </div>
                        <div class="flight_arrival_time">
                          <div class="flex-center extar_flight_origin">
                            <h5>{{ q.destination }}</h5>
                            <p
                              class="extra_flight_arrival"
                              style="padding-left:10px"
                            >{{ q.arr_time }}</p>
                          </div>

                          <p class="pl-5 extra_destination">{{ q.destination_fullname }}</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div v-if="p.isRound == 1" class="flight_details_border">
                    <div v-for="(q , qIndex) in amadeus[index].round_seg" :key="q.id">
                      <hr v-if="qIndex != 0" class="dashed-line" />
                      <div class="extra_flight_data flex-between">
                        <div class="extra_flight_name">
                          <img
                            class="extra_carrier_icon"
                            :src="'https://c.fareportal.com/n/common/air/3x/' + q.round_carrier_icon + '.png'"
                          />
                          <p>{{ q.round_carrier_name }}</p>
                          <p>{{ q.round_carrier_icon }} - {{ q.round_flight_number }}</p>
                        </div>
                        <div class="flight_departure_time">
                          <div class="flex-center extar_flight_origin">
                            <h5>{{ q.round_origin }}</h5>
                            <p
                              class="extra_flight_departure"
                              style="padding-left:10px"
                            >{{ q.round_dep_time }}</p>
                          </div>
                          <p class="pl-5 extra_destination">{{ q.round_origin_fullname }}</p>
                        </div>
                        <div class="extra_duration extar_flight_origin center">
                          <p style="font-size:11px;color:#b5b5b5">Flight Duration</p>
                          <h5>{{q.round_duration}}</h5>
                        </div>
                        <div class="flight_arrival_time">
                          <div class="flex-center extar_flight_origin">
                            <h5>{{ q.round_destination }}</h5>
                            <p
                              class="extra_flight_arrival"
                              style="padding-left:10px"
                            >{{ q.round_arr_time }}</p>
                          </div>
                          <p class="pl-5 extra_destination">{{ q.round_destination_fullname }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col s12">
            <div id="loop_here"></div>
          </div>
          <div class="col s12">
            <div id="loop_hereRe"></div>
          </div>
          <div class="col s24">
            <div id="goibibo_internation">
              <!-- <div class="car">
              <div class="flight_name">
                <p>Aeroflot Russian Airlines</p>
                <p class="pl-5">SU - 103</p>
              </div>
              <div class="flight_data flex-between">
                <div class="flight_departure_time">
                  <div class="flex-center flight_origin">
                    <h5>JFK</h5>
                  </div>
                  <p class="flight_departure">19:20</p>
                </div>

                <div class="flight_duration">
                  <div class="flex-center flight_change">
                    <span>-</span>
                    <h5>SOV</h5>
                    <span>-</span>
                  </div>
                  <p class="flight_departure">22h 40m</p>
                </div>

                <div class="flight_arrival_time">
                  <div class="flex-center flight_origin">
                    <h5>DEL</h5>
                  </div>
                  <p class="flight_arrival">03:20</p>
                </div>
                <div class="flight_price">
                  <h3>₹63263</h3>
                </div>
                <div class="flight_book">
                  <button type="button" @click="submit" class="btn">Book Now</button>
                </div>
              </div>
              </div>-->
            </div>
          </div>
        </div>

        <!-- <div id="loop_here">
         <div class="card">
          <div class="flight_name">
            <p>Air India</p>
            <p class="pl-5">SG - 12345</p>
          </div>

          <div class="flight_data flex-between">
            <div class="flight_departure_time">v
              <div class="flex-center flight_origin">
                <h5>GAU</h5>
                <h5 class="pl-5">Guwahati, India</h5>
              </div>
              <p class="flight_departure">18:10</p>
            </div>
            <div class="flight_arrival_time">
              <div class="flex-center flight_origin">
                <h5>GAU</h5>
                <h5 class="pl-5">Hyderabad, India</h5>
              </div>
              <p class="flight_arrival">02:45</p>
            </div>
            <div class="flight_price">
              <h3>7000</h3>
            </div>
            <div class="flight_book">
              <button type="button" @click="submit" class="btn">Book Now</button>
            </div>
          </div>
        </div>
        </div>-->
      </div>
    </div>

    <div style="background-color:#03A9F4">
      <div class="container section">
        <div style=" display:flex; justify-content:space-between; height: 120px;line-height: 120px;">
          <h3 style="color:white">Call For Unpublished Cheap Flight Deals</h3>
          <h3 style="color:white">Toll Free no: +1-888-454-1363</h3>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import axios from "axios";
axios.defaults.withCredentials = false;

export default {
  data: () => ({
    token: "https://test.api.amadeus.com/v1/security/oauth2/token",
    flight_search: "https://test.api.amadeus.com/v1/shopping/flight-offers?",
    flight_search_ibibo: "http://developer.goibibo.com/api/search/?",
    access_token: "",
    origin: "",
    destination: "",
    departureDate: "",
    nonStop: "",
    adults: 1,
    children: 0,
    infants: 0,
    currency: [],
    travelClass: [],
    airportList: [],
    airportListArr: [],
    typingTimer: 0,
    picked: "oneway",
    source: "amadeus",
    isInternationDep: 0,
    isInternationArr: 0,

    amadeus: [],
    amadeusReturn: [],
    carrier_list: [],
    transaction_id: 0,
    formed_data: []
  }),

  mounted() {
    this.getToken();


    var dp = $(".datepicker-here")
      .datepicker({
        autoClose: true
      })
      .data("datepicker");

    dp.selectDate(new Date());

    //TOGGLING NESTED ul
    $(".drop-down .selected a").click(function() {
      $(".drop-down .options ul").toggle();
    });

    //SELECT OPTIONS AND HIDE OPTION AFTER SELECTION
    $(".drop-down .options ul li a").click(function() {
      var text = $(this).html();
      $(".drop-down .selected a span").html(text);
      $(".drop-down .options ul").hide();
    });

    //HIDE OPTIONS IF CLICKED ANYWHERE ELSE ON PAGE
    $(document).bind("click", function(e) {
      var $clicked = $(e.target);
      if (!$clicked.parents().hasClass("drop-down"))
        $(".drop-down .options ul").hide();
    });

    //TOGGLING NESTED ul
    $(".drop-down1 .selected a").click(function() {
      $(".drop-down1 .options ul").toggle();
    });

    //SELECT OPTIONS AND HIDE OPTION AFTER SELECTION
    $(".drop-down1 .options ul li a").click(function() {
      var text = $(this).html();
      $(".drop-down1 .selected a span").html(text);
      $(".drop-down1 .options ul").hide();
    });

    //HIDE OPTIONS IF CLICKED ANYWHERE ELSE ON PAGE
    $(document).bind("click", function(e) {
      var $clicked = $(e.target);
      if (!$clicked.parents().hasClass("drop-down1"))
        $(".drop-down1 .options ul").hide();
    });

    //TOGGLING NESTED ul
    $(".drop-down2 .selected a").click(function() {
      $(".drop-down2 .options ul").toggle();
    });

    //SELECT OPTIONS AND HIDE OPTION AFTER SELECTION
    $(".drop-down2 .options ul li a").click(function() {
      var text = $(this).html();
      $(".drop-down2 .selected a span").html(text);
      $(".drop-down2 .options ul").hide();
    });

    //HIDE OPTIONS IF CLICKED ANYWHERE ELSE ON PAGE
    $(document).bind("click", function(e) {
      var $clicked = $(e.target);
      if (!$clicked.parents().hasClass("drop-down2"))
        $(".drop-down2 .options ul").hide();
    });

    //TOGGLING NESTED ul
    $(".drop-down3 .selected a").click(function() {
      $(".drop-down3 .options ul").toggle();
    });

    //SELECT OPTIONS AND HIDE OPTION AFTER SELECTION
    $(".drop-down3 .options ul li a").click(function() {
      var text = $(this).html();
      $(".drop-down3 .selected a span").html(text);
      $(".drop-down3 .options ul").hide();
    });

    //HIDE OPTIONS IF CLICKED ANYWHERE ELSE ON PAGE
    $(document).bind("click", function(e) {
      var $clicked = $(e.target);
      if (!$clicked.parents().hasClass("drop-down3"))
        $(".drop-down3 .options ul").hide();
    });
  },

  methods: {
    getToken: function() {
      axios({
        method: "POST",
        url: this.token,
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        data:
          "client_id=i5t5vHAMFeApnN7kGNlV5zabRd8BxvcZ&client_secret=qzGD0OTlANAChgXs&grant_type=client_credentials"
      })
        .then(res => {
          console.log("res", res);
          console.log("Token Generated");
          console.log(res.data.access_token);
          this.access_token = res.data.access_token;
          this.submit();
        })
        .catch(err => {
          console.log("error in request1", err.response.data.message);
          this.$vs.loading.close();
          this.$vs.notify({
            title: "Login Failed",
            text: err.response.data.message,
            color: "danger",
            time: 5000
          });
        });

      // $.ajax({
      //   url: this.token,
      //   dataType: "json",
      //   type: "POST",
      //   data: {
      //     client_id: "i5t5vHAMFeApnN7kGNlV5zabRd8BxvcZ",
      //     client_secret: "qzGD0OTlANAChgXs",
      //     grant_type: "client_credentials"
      //   },
      //   success: function(data, status) {
      //     console.log("Token Generated");
      //     console.log(data.access_token);
      //     this.access_token = data.access_token;
      //   }
      // });
    },

    //     radioClicked: function(){

    //  $('.datepicker-here').datepicker()

    //     },
    submit: function() {
      $("#result_section").removeClass("hide");
      $(".loader").removeClass("hide");
      $("#amadeus").empty();
      $("#loop_here").empty();
      $("#loop_hereRe").empty();
      $("#goibibo_internation").empty();

      this.amadeus = [];

      if (this.source == "amadeus") {

        this.origin =  localStorage.getItem('to');
        this.destination =  localStorage.getItem('from');
        this.departureDate =  localStorage.getItem('departure');
        this.returnDate =  localStorage.getItem('return');
        this.adults =  localStorage.getItem('adult');
        this.children =  localStorage.getItem('children');
        this.infants =  localStorage.getItem('infants');
        this.nonStop = false;
        this.currency = "USD";
        this.travelClass =  localStorage.getItem('travel_class' );

        var url = "";

        if (this.picked == "oneway") {
          url =
            this.flight_search +
            "origin=" +
            this.origin +
            "&destination=" +
            this.destination +
            "&departureDate=" +
            this.departureDate +
            "&adults=" +
            this.adults +
            "&children=" +
            this.children +
            "&infants=" +
            this.infants +
            "&nonStop=" +
            this.nonStop +
            "&currency=" +
            this.currency +
            "&travelClass=" +
            this.travelClass +
            "";
        } else {
          url =
            this.flight_search +
            "origin=" +
            this.origin +
            "&destination=" +
            this.destination +
            "&departureDate=" +
            this.departureDate +
            "&returnDate=" +
            this.returnDate +
            "&adults=" +
            this.adults +
            "&children=" +
            this.children +
            "&infants=" +
            this.infants +
            "&nonStop=" +
            this.nonStop +
            "&currency=" +
            this.currency +
            "&travelClass=" +
            this.travelClass +
            "";
        }

        axios({
          method: "GET",
          url: url,
          headers: {
            Authorization: "Bearer " + this.access_token
          }
        })
          .then(res => {
            console.log("res", res);

            var data = res.data;

            $(".loader").addClass("hide");

            // var data = JSON.parse(localStorage.getItem("data"));

            console.log(data.data);

            $("#amadeus").empty();
            $("#loop_here").empty();

            var currency_name = data.meta.currency;
            this.carrier_list = data.dictionaries.carriers;
            var places_list = data.dictionaries.locations;

            var symbol = "$";

            // switch (currency_name) {
            //   case "USD":
            //     symbol = "$";
            //     break;

            //   case "INR":
            //     symbol = "₹";
            //     break;
            // }

            data.data = this.getSortedData(data.data, 1);

            for (var i = 0; i < data.data.length; i++) {
              var temp = {};
              var seg = [];
              var round_seg = [];
              var duration = 0;
              var round_duration = 0;

              for (
                var j = 0;
                j < data.data[i].offerItems[0].services[0].segments.length;
                j++
              ) {
                var tmp = {};

                tmp.carrier_name = this.capitalizeFirstLetter(
                  this.getJSONKeyValue(
                    this.carrier_list,
                    data.data[i].offerItems[0].services[0].segments[j]
                      .flightSegment.carrierCode
                  )
                );

                tmp.carrier_icon =
                  data.data[i].offerItems[0].services[0].segments[
                    j
                  ].flightSegment.carrierCode;

                tmp.origin =
                  data.data[i].offerItems[0].services[0].segments[
                    j
                  ].flightSegment.departure.iataCode;

                tmp.origin_fullname = this.capitalizeFirstLetter(
                  this.getJSONKeyValue(
                    places_list,
                    data.data[i].offerItems[0].services[0].segments[0]
                      .flightSegment.departure.iataCode
                  ).detailedName
                );

                tmp.dep_time = data.data[i].offerItems[0].services[0].segments[
                  j
                ].flightSegment.departure.at
                  .split("T")
                  ["1"].split("-")
                  ["0"].split(":")
                  .slice(0, 2)
                  .join(":");

                tmp.destination =
                  data.data[i].offerItems[0].services[0].segments[
                    j
                  ].flightSegment.arrival.iataCode;

                tmp.destination_fullname = this.capitalizeFirstLetter(
                  this.getJSONKeyValue(
                    places_list,
                    data.data[i].offerItems[0].services[0].segments[j]
                      .flightSegment.arrival.iataCode
                  ).detailedName
                );

                tmp.arr_time = data.data[i].offerItems[0].services[0].segments[
                  j
                ].flightSegment.arrival.at
                  .split("T")
                  ["1"].split("-")
                  ["0"].split(":")
                  .slice(0, 2)
                  .join(":");

                tmp.flight_number =
                  data.data[i].offerItems[0].services[0].segments[
                    j
                  ].flightSegment.number;

                var temp_d =
                  data.data[i].offerItems[0].services[0].segments[j]
                    .flightSegment.duration;

                var day = temp_d.split("DT")[0];

                var hour = temp_d.split("DT")[1].split("H")[0];

                var minute = temp_d
                  .split("DT")[1]
                  .split("H")[1]
                  .split("M")[0];

                var seconds = day * 3600 * 24 + hour * 3600 + minute * 60;

                duration = duration + seconds;

                console.log(seconds);

                tmp.duration = this.seconds_to_date(seconds);

                seg.push(tmp);
              }

              temp.duration = this.seconds_to_date(duration);

              temp.carrier_name = this.capitalizeFirstLetter(
                this.getJSONKeyValue(
                  this.carrier_list,
                  data.data[i].offerItems[0].services[0].segments[
                    data.data[i].offerItems[0].services[0].segments.length - 1
                  ].flightSegment.carrierCode
                )
              );

              temp.carrier_icon =
                data.data[i].offerItems[0].services[0].segments[
                  data.data[i].offerItems[0].services[0].segments.length - 1
                ].flightSegment.carrierCode;

              temp.origin =
                data.data[
                  i
                ].offerItems[0].services[0].segments[0].flightSegment.departure.iataCode;

              temp.origin_fullname = this.capitalizeFirstLetter(
                this.getJSONKeyValue(
                  places_list,
                  data.data[i].offerItems[0].services[0].segments[0]
                    .flightSegment.departure.iataCode
                ).detailedName
              );

              temp.dep_time = data.data[
                i
              ].offerItems[0].services[0].segments[0].flightSegment.departure.at
                .split("T")
                ["1"].split("-")
                ["0"].split(":")
                .slice(0, 2)
                .join(":");

              temp.destination =
                data.data[i].offerItems[0].services[0].segments[
                  data.data[i].offerItems[0].services[0].segments.length - 1
                ].flightSegment.arrival.iataCode;

              temp.destination_fullname = this.capitalizeFirstLetter(
                this.getJSONKeyValue(
                  places_list,
                  data.data[i].offerItems[0].services[0].segments[
                    data.data[i].offerItems[0].services[0].segments.length - 1
                  ].flightSegment.arrival.iataCode
                ).detailedName
              );

              temp.arr_time = data.data[i].offerItems[0].services[0].segments[
                data.data[i].offerItems[0].services[0].segments.length - 1
              ].flightSegment.arrival.at
                .split("T")
                ["1"].split("-")
                ["0"].split(":")
                .slice(0, 2)
                .join(":");

              temp.price = data.data[i].offerItems[0].pricePerAdult.total;

              temp.seg = seg;

              temp.isRound = 0;

              if (data.data[i].offerItems[0].services.length == 2) {
                temp.isRound = 1;

                for (
                  var j = 0;
                  j < data.data[i].offerItems[0].services[1].segments.length;
                  j++
                ) {
                  var tmp = {};

                  tmp.round_carrier_name = this.capitalizeFirstLetter(
                    this.getJSONKeyValue(
                      this.carrier_list,
                      data.data[i].offerItems[0].services[1].segments[j]
                        .flightSegment.carrierCode
                    )
                  );

                  tmp.round_carrier_icon =
                    data.data[i].offerItems[0].services[1].segments[
                      j
                    ].flightSegment.carrierCode;

                  tmp.round_origin =
                    data.data[i].offerItems[0].services[1].segments[
                      j
                    ].flightSegment.departure.iataCode;

                  tmp.round_origin_fullname = this.capitalizeFirstLetter(
                    this.getJSONKeyValue(
                      places_list,
                      data.data[i].offerItems[0].services[1].segments[0]
                        .flightSegment.departure.iataCode
                    ).detailedName
                  );

                  tmp.round_dep_time = data.data[
                    i
                  ].offerItems[0].services[1].segments[
                    j
                  ].flightSegment.departure.at
                    .split("T")
                    ["1"].split("-")
                    ["0"].split(":")
                    .slice(0, 2)
                    .join(":");

                  tmp.round_destination =
                    data.data[i].offerItems[0].services[1].segments[
                      j
                    ].flightSegment.arrival.iataCode;

                  tmp.round_destination_fullname = this.capitalizeFirstLetter(
                    this.getJSONKeyValue(
                      places_list,
                      data.data[i].offerItems[0].services[1].segments[j]
                        .flightSegment.arrival.iataCode
                    ).detailedName
                  );

                  tmp.round_arr_time = data.data[
                    i
                  ].offerItems[0].services[1].segments[
                    j
                  ].flightSegment.arrival.at
                    .split("T")
                    ["1"].split("-")
                    ["0"].split(":")
                    .slice(0, 2)
                    .join(":");

                  tmp.round_flight_number =
                    data.data[i].offerItems[0].services[1].segments[
                      j
                    ].flightSegment.number;

                  var temp_d =
                    data.data[i].offerItems[0].services[1].segments[j]
                      .flightSegment.duration;

                  var day = temp_d.split("DT")[0];

                  var hour = temp_d.split("DT")[1].split("H")[0];

                  var minute = temp_d
                    .split("DT")[1]
                    .split("H")[1]
                    .split("M")[0];

                  var seconds = day * 3600 * 24 + hour * 3600 + minute * 60;

                  round_duration = round_duration + seconds;

                  console.log(seconds);

                  tmp.round_duration = this.seconds_to_date(seconds);

                  round_seg.push(tmp);
                }

                temp.round_duration = this.seconds_to_date(round_duration);

                temp.round_carrier_name = this.capitalizeFirstLetter(
                  this.getJSONKeyValue(
                    this.carrier_list,
                    data.data[i].offerItems[0].services[1].segments[
                      data.data[i].offerItems[0].services[1].segments.length - 1
                    ].flightSegment.carrierCode
                  )
                );

                temp.round_carrier_icon =
                  data.data[i].offerItems[0].services[1].segments[
                    data.data[i].offerItems[0].services[1].segments.length - 1
                  ].flightSegment.carrierCode;

                temp.round_origin =
                  data.data[
                    i
                  ].offerItems[0].services[1].segments[0].flightSegment.departure.iataCode;

                temp.round_origin_fullname = this.capitalizeFirstLetter(
                  this.getJSONKeyValue(
                    places_list,
                    data.data[i].offerItems[0].services[1].segments[0]
                      .flightSegment.departure.iataCode
                  ).detailedName
                );

                temp.round_dep_time = data.data[
                  i
                ].offerItems[0].services[1].segments[0].flightSegment.departure.at
                  .split("T")
                  ["1"].split("-")
                  ["0"].split(":")
                  .slice(0, 2)
                  .join(":");

                temp.round_destination =
                  data.data[i].offerItems[0].services[1].segments[
                    data.data[i].offerItems[0].services[1].segments.length - 1
                  ].flightSegment.arrival.iataCode;

                temp.round_destination_fullname = this.capitalizeFirstLetter(
                  this.getJSONKeyValue(
                    places_list,
                    data.data[i].offerItems[0].services[1].segments[
                      data.data[i].offerItems[0].services[1].segments.length - 1
                    ].flightSegment.arrival.iataCode
                  ).detailedName
                );

                temp.round_arr_time = data.data[
                  i
                ].offerItems[0].services[1].segments[
                  data.data[i].offerItems[0].services[1].segments.length - 1
                ].flightSegment.arrival.at
                  .split("T")
                  ["1"].split("-")
                  ["0"].split(":")
                  .slice(0, 2)
                  .join(":");

                temp.round_price = data.data[i].offerItems[0].pricePerAdult.total;

                temp.round_seg = round_seg;
              }

              this.amadeus.push(temp);

              console.log(this.amadeus);
            }

            // for (var i = 0; i < data.data.length; i++) {

            //             this.amadeusReturn.push(temp);

            //             console.log(this.amadeusReturn);
            //           }

            // for (var i = 0; i < data.data.length; i++) {
            //   var pricing = data.data[i].offerItems[0].pricePerAdult.total;

            //   if (data.data[i].offerItems[0].services[0].segments.length == 1) {
            //     console.log("one");

            //     console.log(
            //       this.getJSONKeyValue(
            //         places_list,
            //         data.data[i].offerItems[0].services[0].segments[0]
            //           .flightSegment.departure.iataCode
            //       )
            //     );

            //     var loop =
            //       '<div class="card oneseg"> <div class="flight_name"> <p>' +
            //       this.capitalizeFirstLetter(
            //         this.getJSONKeyValue(
            //           carrier_list,
            //           data.data[i].offerItems[0].services[0].segments[0]
            //             .flightSegment.carrierCode
            //         )
            //       ) +
            //       '</p> <p class="pl-5">' +
            //       data.data[i].offerItems[0].services[0].segments[0]
            //         .flightSegment.operating.carrierCode +
            //       " - " +
            //       data.data[i].offerItems[0].services[0].segments[0]
            //         .flightSegment.operating.number +
            //       '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
            //       data.data[i].offerItems[0].services[0].segments[0]
            //         .flightSegment.departure.iataCode +
            //       '</h5> <h5 class="pl-5">' +
            //       this.capitalizeFirstLetter(
            //         this.getJSONKeyValue(
            //           places_list,
            //           data.data[i].offerItems[0].services[0].segments[0]
            //             .flightSegment.departure.iataCode
            //         ).detailedName
            //       ) +
            //       '</h5> </div> <p class="flight_departure">' +
            //       data.data[
            //         i
            //       ].offerItems[0].services[0].segments[0].flightSegment.departure.at
            //         .split("T")
            //         ["1"].split("-")
            //         ["0"].split(":")
            //         .slice(0, 2)
            //         .join(":") +
            //       '</p> </div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
            //       data.data[i].offerItems[0].services[0].segments[0]
            //         .flightSegment.arrival.iataCode +
            //       '</h5> <h5 class="pl-5">' +
            //       this.capitalizeFirstLetter(
            //         this.getJSONKeyValue(
            //           places_list,
            //           data.data[i].offerItems[0].services[0].segments[0]
            //             .flightSegment.arrival.iataCode
            //         ).detailedName
            //       ) +
            //       '</h5> </div> <p class="flight_arrival">' +
            //       data.data[
            //         i
            //       ].offerItems[0].services[0].segments[0].flightSegment.arrival.at
            //         .split("T")
            //         ["1"].split("-")
            //         ["0"].split(":")
            //         .slice(0, 2)
            //         .join(":") +
            //       '</p> </div> <div class="flight_price"> <h3>' +
            //       symbol +
            //       pricing +
            //       '</h3> </div> <div class="flight_book"> <button type="button" @click="submit" class="btn">Book Now</button> </div> </div> </div>';
            //   } else if (
            //     data.data[i].offerItems[0].services[0].segments.length == 2
            //   ) {
            //     console.log("two");
            //     var loop =
            //       '<div class="card twoseg"> <div class="flight_name"> <p>' +
            //       this.capitalizeFirstLetter(this.getJSONKeyValue(
            //         carrier_list,
            //         data.data[i].offerItems[0].services[0].segments[0]
            //           .flightSegment.carrierCode
            //       )) +
            //       '</p> <p class="pl-5">' +
            //       data.data[i].offerItems[0].services[0].segments[0]
            //         .flightSegment.operating.carrierCode +
            //       " - " +
            //       data.data[i].offerItems[0].services[0].segments[0]
            //         .flightSegment.operating.number +
            //       '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
            //       data.data[i].offerItems[0].services[0].segments[0]
            //         .flightSegment.departure.iataCode +
            //       '</h5> <h5 class="pl-5">' +
            //       this.capitalizeFirstLetter(this.getJSONKeyValue(
            //         places_list,
            //         data.data[i].offerItems[0].services[0].segments[0]
            //           .flightSegment.departure.iataCode
            //       ).detailedName) +
            //       '</h5> </div> <p class="flight_departure">' +
            //       data.data[
            //         i
            //       ].offerItems[0].services[0].segments[0].flightSegment.departure.at
            //         .split("T")
            //         ["1"].split("-")
            //         ["0"].split(":")
            //         .slice(0, 2)
            //         .join(":") +
            //       '</p> </div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
            //       data.data[i].offerItems[0].services[0].segments[1]
            //         .flightSegment.arrival.iataCode +
            //       '</h5> <h5 class="pl-5">' +
            //       this.capitalizeFirstLetter(this.getJSONKeyValue(
            //         places_list,
            //         data.data[i].offerItems[0].services[0].segments[1]
            //           .flightSegment.arrival.iataCode
            //       ).detailedName) +
            //       '</h5> </div> <p class="flight_arrival">' +
            //       data.data[
            //         i
            //       ].offerItems[0].services[0].segments[1].flightSegment.arrival.at
            //         .split("T")
            //         ["1"].split("-")
            //         ["0"].split(":")
            //         .slice(0, 2)
            //         .join(":") +
            //       '</p> </div> <div class="flight_price"> <h3>' +
            //       symbol +
            //       pricing +
            //       '</h3> </div> <div class="flight_book"> <button type="button" @click="submit" class="btn">Book Now</button> </div> </div> </div>';
            //   } else {
            //     console.log("more");
            //   }

            //   var d1 = document.getElementById("amadeus");
            //   d1.insertAdjacentHTML("beforeend", loop);
            // }
          })
          .catch(err => {
            console.log(err.response);

            switch (err.response.status) {
              case 401:
                console.log("Token Expired");
                break;

              case 404:
                console.log("Not found");
                break;
            }
          });
      } else if (this.source == "goibibo") {
        this.origin = "JFK";
        this.destination = "LAX";
        this.departureDate = 20190901;
        this.arrival = 20190920;
        this.adults = 1;
        this.nonStop = false;
        this.currency = "USD";
        this.seatingclass = "E";

        axios({
          method: "GET",
          url:
            this.flight_search_ibibo +
            "app_id=b7f6ec04" +
            "&app_key=8f77e825ac8eb70ac5e4bf90bcdbb162" +
            "&format=json" +
            "&source=" +
            $("#from_iata").val() +
            "&destination=" +
            $("#to_iata").val() +
            "&dateofdeparture=" +
            this.departureDate +
            "&dateofarrival=" +
            this.arrival +
            "&seatingclass=" +
            this.seatingclass +
            "&adults=" +
            this.adults +
            "&children=" +
            0 +
            "&infants=" +
            0 +
            "&counter=0"
        })
          .then(res => {
            console.log("res", res.data.data.onwardflights);

            var data = res.data.data.onwardflights;
            var returnflights = res.data.data.returnflights;

            data = this.getSortedDataGo(data, 1);
            returnflights = this.getSortedDataGo(returnflights, 1);

            var symbol = "₹";

            //  console.log(this.fixData(res.data.data.onwardflights))

            if (this.isInternationDep == 0) {
              for (var i = 0; i < data.length; i++) {
                console.log("one");

                console.log(parseInt(data[i].stops));

                if (parseInt(data[i].stops) == 0) {
                  var loop =
                    '<div class="card no-stops"> <div class="flight_name"> <p>' +
                    data[i].airline +
                    '</p> <p class="pl-5">' +
                    data[i].carrierid +
                    " - " +
                    data[i].flightno +
                    '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
                    data[i].origin +
                    '</h5></div> <p class="flight_departure">' +
                    data[i].deptime +
                    '</p> </div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
                    data[i].destination +
                    '</h5></div> <p class="flight_arrival">' +
                    data[i].arrtime +
                    '</p> </div> <div class="flight_price"><h3>' +
                    symbol +
                    data[i].fare["totalfare"] +
                    '</h3> </div> <div class="flight_book"> <button type="button" @click="submit" class="btn">Book Now</button> </div> </div> </div>';

                  var d1 = document.getElementById("loop_here");
                  d1.insertAdjacentHTML("beforeend", loop);
                } else if (parseInt(data[i].stops) > 0) {
                  var loop =
                    '<div class="card"> <div class="flight_name"> <p>' +
                    data[i].airline +
                    '</p> <p class="pl-5">' +
                    data[i].carrierid +
                    " - " +
                    data[i].flightno +
                    '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
                    data[i].origin +
                    '</h5></div> <p class="flight_departure">' +
                    data[i].deptime +
                    '</p> </div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
                    data[i].onwardflights[0].destination +
                    '</h5>  </div> <p class="flight_arrival">' +
                    data[i].onwardflights[0].arrtime +
                    '</p> </div> <div class="flight_price"><h3>' +
                    symbol +
                    data[i].fare["totalfare"] +
                    '</h3> </div> <div class="flight_book"> <button type="button" @click="submit" class="btn">Book Now</button> </div> </div> </div>';

                  var d1 = document.getElementById("loop_here");
                  d1.insertAdjacentHTML("beforeend", loop);
                }
              }

              for (var i = 0; i < returnflights.length; i++) {
                console.log("one");

                console.log(parseInt(returnflights[i].stops));

                if (parseInt(returnflights[i].stops) == 0) {
                  var loop =
                    '<div class="card"> <div class="flight_name"> <p>' +
                    returnflights[i].airline +
                    '</p> <p class="pl-5">' +
                    returnflights[i].carrierid +
                    " - " +
                    returnflights[i].flightno +
                    '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
                    returnflights[i].origin +
                    '</h5></div> <p class="flight_departure">' +
                    returnflights[i].deptime +
                    '</p> </div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
                    returnflights[i].destination +
                    '</h5></div> <p class="flight_arrival">' +
                    returnflights[i].arrtime +
                    '</p> </div> <div class="flight_price"><h3>' +
                    symbol +
                    returnflights[i].fare["totalfare"] +
                    '</h3> </div> <div class="flight_book"> <button type="button" @click="submit" class="btn">Book Now</button> </div> </div> </div>';

                  var d1 = document.getElementById("loop_hereRe");
                  d1.insertAdjacentHTML("beforeend", loop);
                } else if (parseInt(returnflights[i].stops) > 0) {
                  var loop =
                    '<div class="card"> <div class="flight_name"> <p>' +
                    returnflights[i].airline +
                    '</p> <p class="pl-5">' +
                    returnflights[i].carrierid +
                    " - " +
                    returnflights[i].flightno +
                    '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
                    returnflights[i].origin +
                    '</h5></div> <p class="flight_departure">' +
                    returnflights[i].deptime +
                    '</p> </div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
                    returnflights[i].onwardflights[0].destination +
                    '</h5>  </div> <p class="flight_arrival">' +
                    returnflights[i].onwardflights[0].arrtime +
                    '</p> </div> <div class="flight_price"><h3>' +
                    symbol +
                    returnflights[i].fare["totalfare"] +
                    '</h3> </div> <div class="flight_book"> <button type="button" @click="submit" class="btn">Book Now</button> </div> </div> </div>';

                  var d1 = document.getElementById("loop_hereRe");
                  d1.insertAdjacentHTML("beforeend", loop);
                }
              }
            } else {
              console.log("Internation result");

              for (var i = 0; i < data.length; i++) {
                console.log(data[i].returnfl.length);
                if (data[i].returnfl.length == 0) {
                  var loop =
                    '<div class="card"> <div class="flight_name"> <p>' +
                    data[i].airline +
                    '</p> <p class="pl-5">' +
                    data[i].carrierid +
                    " - " +
                    data[i].flightno +
                    '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
                    data[i].origin +
                    '</h5></div> <p class="flight_departure">' +
                    data[i].deptime +
                    '</p> </div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
                    data[i].onwardflights[0].destination +
                    '</h5>  </div> <p class="flight_arrival">' +
                    data[i].onwardflights[0].arrtime +
                    '</p> </div> <div class="flight_price"><h3>' +
                    symbol +
                    data[i].fare["totalfare"] +
                    '</h3> </div> <div class="flight_book"> <button type="button" @click="submit" class="btn">Book Now</button> </div> </div> </div>';

                  var d1 = document.getElementById("goibibo_internation");
                  d1.insertAdjacentHTML("beforeend", loop);
                } else {
                  console.log(data[i].returnfl[0].destination);
                  console.log(i);

                  var onwardflights,
                    arrtime,
                    returnflights,
                    returnflightsArr,
                    originStops,
                    returnedStops;

                  if (data[i].onwardflights.length == 0) {
                    onwardflights = data[i].destination;
                    returnflights = data[i].returnfl[0].destination;

                    arrtime = data[i].arrtime;
                  } else {
                    console.log(data[i].onwardflights.length - 1);

                    onwardflights =
                      data[i].onwardflights[data[i].onwardflights.length - 1]
                        .destination;

                    if (data[i].returnfl.length == 0) {
                      returnflights = data[i].returnfl[0].destination;
                      returnflightsArr = data[i].returnfl[0].arrtime;
                    } else {
                      var originStops = "";
                      var returnedStops = "";

                      var returned_length = 0;
                      var origin_length = 0;

                      if (data[i].returnfl[0].onwardflights.length == 1) {
                        returned_length = 1;
                      } else {
                        returned_length =
                          data[i].returnfl[0].onwardflights.length;
                      }

                      if (data[i].onwardflights.length == 1) {
                        origin_length = 1;
                      } else {
                        origin_length = data[i].onwardflights.length;
                      }

                      for (var j = 0; j < returned_length; j++) {
                        returnedStops = returnedStops.concat(
                          " - " + data[i].returnfl[0].onwardflights[j].origin
                        );
                      }

                      console.log("origin_length");
                      console.log(origin_length);

                      for (var j = 0; j < origin_length; j++) {
                        console.log(originStops);

                        originStops = originStops.concat(
                          " - " + data[i].onwardflights[j].origin
                        );
                      }

                      returnflights =
                        data[i].returnfl[0].onwardflights[
                          data[i].returnfl[0].onwardflights.length - 1
                        ].destination;

                      returnflightsArr =
                        data[i].returnfl[0].onwardflights[
                          data[i].returnfl[0].onwardflights.length - 1
                        ].arrtime;
                    }

                    arrtime = data[i].onwardflights[0].arrtime;
                  }

                  var loop =
                    '<div class="card multi"> <div class="flight_name"> <p>' +
                    data[i].airline +
                    '</p> <p class="pl-5">' +
                    data[i].carrierid +
                    " - " +
                    data[i].flightno +
                    '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
                    data[i].origin +
                    '</h5></div> <p class="flight_departure">' +
                    data[i].deptime +
                    '</p> </div> <div class="flight_duration"><div class="flex-center flight_change"><span> - </span><h5>' +
                    originStops +
                    '</h5> <span> - </span></div><p class="flight_duration">' +
                    data[i].duration +
                    '</p></div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
                    onwardflights +
                    '</h5>  </div> <p class="flight_arrival">' +
                    arrtime +
                    '</p> </div> <div class="flight_price"><h3>' +
                    symbol +
                    data[i].fare["totalfare"] +
                    '</h3> </div> <div class="flight_book"> <button type="button" @click="submit" class="btn">Book Now</button> </div> </div><hr class="dashed-line"/><div class="flight_name"> <p>' +
                    data[i].returnfl[0].airline +
                    '</p> <p class="pl-5">' +
                    data[i].returnfl[0].carrierid +
                    " - " +
                    data[i].returnfl[0].flightno +
                    '</p> </div> <div class="flight_data flex-between"> <div class="flight_departure_time"> <div class="flex-center flight_origin"> <h5>' +
                    data[i].returnfl[0].origin +
                    '</h5></div> <p class="flight_departure">' +
                    data[i].returnfl[0].deptime +
                    '</p> </div> <div class="flight_duration"><div class="flex-center flight_change"><span> - </span><h5>' +
                    returnedStops +
                    '</h5> <span> - </span></div><p class="flight_duration">' +
                    data[i].duration +
                    '</p></div> <div class="flight_arrival_time"> <div class="flex-center flight_origin"> <h5>' +
                    returnflights +
                    '</h5>  </div> <p class="flight_arrival">' +
                    returnflightsArr +
                    '</p> </div> <div class="flight_price" style="opacity:0"><h3>₹0ffffff</h3> </div> <div class="flight_book"><button type="button" style="opacity:0" class="btn">Book Now</button></div> </div> </div>';

                  var d1 = document.getElementById("goibibo_internation");
                  d1.insertAdjacentHTML("beforeend", loop);
                }
              }
            }
          })
          .catch(err => {
            console.log(err);
          });
      }
    },
    getSortedData: function(data, isAsc) {
      return data.sort((a, b) => {
        return (
          (a.offerItems[0].pricePerAdult.total < b.offerItems[0].pricePerAdult.total &&
          a.offerItems[0].services[0].segments[0].flightSegment.departure ==
            $("#from_iata").val()
            ? -1
            : 1) * (isAsc ? 1 : -1)
        );
      });
    },
    getSortedDataGo: function(data, isAsc) {
      return data.sort((a, b) => {
        return (
          (a.fare.totalfare < b.fare.totalfare ? -1 : 1) * (isAsc ? 1 : -1)
        );
      });
    },
    capitalizeFirstLetter: function(string) {
      console.log(
        string.charAt(0).toUpperCase() + string.toLowerCase().slice(1)
      );
      return string
        .toLowerCase()
        .split(" ")
        .map(s => s.charAt(0).toUpperCase() + s.substring(1))
        .join(" ");
    },
    startCountdown: function(e) {
      clearTimeout(this.typingTimer);
      this.typingTimer = setTimeout(this.getAirport, 500);
    },
    startCountdownArr: function(e) {
      clearTimeout(this.typingTimer);
      this.typingTimer = setTimeout(this.getAirportArr, 500);
    },
    clearCountdown: function(e) {
      $(".des").addClass("hide");
      $(".arr").addClass("hide");
      clearTimeout(this.typingTimer);
    },
    seconds_to_date: function(seconds) {
      // day, h, m and s
      var days = Math.floor(seconds / (24 * 60 * 60));
      seconds -= days * (24 * 60 * 60);
      var hours = Math.floor(seconds / (60 * 60));
      seconds -= hours * (60 * 60);
      var minutes = Math.floor(seconds / 60);
      seconds -= minutes * 60;
      return (0 < days ? days + " day, " : "") + hours + "h " + minutes + "m";
    },
    getAirport: function(e) {
      axios({
        method: "POST",
        url: "http://localhost/api/api.php?search=search&query=" + $("#from_des").val(),
        headers: {
          "Access-Control-Allow-Origin": "*"
        }
      })
        .then(res => {
          console.log("res", res);
          console.log("Token Generated");
          this.airportList = res.data;
          $(".des").removeClass("hide");
        })
        .catch(err => {
          console.log("error in request1", err);
        });
    },
    selectDep: function(id) {
      console.log(id);

      if (this.airportList.filter(v => v.id == id).length > 0) {
        var data_ins =
          this.airportList.filter(v => v.id == id)[0].municipality +
          "(" +
          this.airportList.filter(v => v.id == id)[0].iata_code +
          ")";

        $("#from_iata").val(
          this.airportList.filter(v => v.id == id)[0].iata_code
        );

        $("#from_des").val(data_ins);
        $(".des").addClass("hide");

        if (this.airportList.filter(v => v.id == id)[0].iso_country != "IN") {
          this.isInternationDep = 1;
        } else {
          this.isInternationDep = 0;
        }
      }
    },
    getAirportArr: function(e) {
      axios({
        method: "POST",
        url: "/api/api.php?search=search&query=" + $("#to_arr").val(),
        headers: {
          "Access-Control-Allow-Origin": "*"
        }
      })
        .then(res => {
          console.log("res", res);
          console.log("Token Generated");
          this.airportListArr = res.data;
          $(".arr").removeClass("hide");
        })
        .catch(err => {
          console.log("error in request1", err);
        });
    },
    selectArr: function(id) {
      console.log(id);

      if (this.airportListArr.filter(v => v.id == id).length > 0) {
        var data_ins =
          this.airportListArr.filter(v => v.id == id)[0].municipality +
          "(" +
          this.airportListArr.filter(v => v.id == id)[0].iata_code +
          ")";

        $("#to_arr").val(data_ins);
        $(".arr").addClass("hide");
        $("#to_iata").val(
          this.airportListArr.filter(v => v.id == id)[0].iata_code
        );

        if (
          this.airportListArr.filter(v => v.id == id)[0].iso_country != "IN"
        ) {
          this.isInternationArr = 1;
          this.isInternationDep = 1;
        } else {
          if (this.isInternationDep == 0) {
            this.isInternationDep = 0;
          }
        }
      }
    },
    getJSONKeyValue: function(json, value) {
      for (var i in json) {
        var key = i;
        var val = json[i];
        if (key == value) return val;
      }
    },
    showDetail: function(id) {
      if (!$("#fd-" + id).hasClass("hide")) {
        $(".flight_details").addClass("hide");
      } else {
        $(".flight_details").addClass("hide");
        $("#fd-" + id).removeClass("hide");
      }
    },
    open_form: function(id) {
      $("#form-container").removeClass("hide");

      console.log(id);

      this.formed_data = id;
    },
    close_popup: function() {
      $("#form-container").addClass("hide");
    },
    close_popup_after: function() {
      $("#after-form").addClass("hide");
    },
    submitForm: function() {
      var bodyFormData = new FormData();

      bodyFormData.append("full_name", $("#full_name").val());
      bodyFormData.append("email", $("#email").val());
      bodyFormData.append("formed_data", JSON.stringify(this.formed_data));

      axios({
        method: "POST",
        data: bodyFormData,
        url: "/api/api.php?sendform=sendform",

        headers: {
          "Access-Control-Allow-Origin": "*"
        }
      })
        .then(res => {
          console.log("res", res);
          console.log("Info Added");

          this.transaction_id = res.data.transaction_id;

          $("#after-form").removeClass("hide");

          $("#form-container").addClass("hide");
        })
        .catch(err => {
          console.log("error in request1", err);
        });
    }
  }
};
</script>


<style scoped>
.btn {
  text-decoration: none;
  color: #fff;
  background-color: #f37638;
  text-align: center;
  letter-spacing: 0.5px;
  -webkit-transition: background-color 0.2s ease-out;
  transition: background-color 0.2s ease-out;
  cursor: pointer;
  margin: 10px 0;
  border: none;
  border-radius: 2px;
  display: inline-block;
  height: 36px;
  line-height: 36px;
  padding: 0 16px;
  text-transform: uppercase;
  vertical-align: middle;
  -webkit-tap-highlight-color: transparent;
  font-size: 12px;
}
</style>
